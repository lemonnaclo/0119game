<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>S2-1-001 Virus Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      height: 100%;
      background: #000;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #f5f5f5;
      overflow: hidden;
    }

    .app {
      position: relative;
      width: 100%;
      height: 100vh;
      background: #000 url("static/virus_cat_bgr.png") center/cover no-repeat;
    }

    /* -------------------------------
       ğŸ”µ ìƒë‹¨ HUD (íƒ€ì´ë¨¸ + í˜ì´ì¦ˆ + ì„¤ëª… + ê²Œì´ì§€)
       â†’ ë””ë²„ê·¸ ê²Œì„ê³¼ ë™ì¼í•œ íƒ€ì´ë¨¸ UI ìŠ¤íƒ€ì¼
    --------------------------------*/
    .top-bar {
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(2, 6, 18, 0.85);
      border: 1px solid rgba(120, 200, 255, 0.5);
      box-shadow: 0 0 18px rgba(0, 0, 0, 0.8);
      z-index: 10;
    }

    .timer-phase {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #a3b7ff;
    }

    .timer-display {
      font-size: 20px;
      font-weight: 800;
      letter-spacing: 0.2em;
      color: #00ffd0;
      text-shadow: 0 0 10px rgba(0,255,170,0.8);
      min-width: 110px;
      text-align: center;
    }

    .round-hint {
      font-size: 11px;
      color: #b6c1dd;
      opacity: 0.85;
      white-space: nowrap;
    }

    .gauge-box {
      display: flex;
      gap: 6px;
      margin-left: 4px;
    }

    .gauge {
      width: 22px;
      height: 28px;
      border-radius: 4px;
      background: #222;
      border: 1px solid #555;
      box-shadow: inset 0 0 6px rgba(0,0,0,0.7);
    }

    .gauge.active {
      background: #ff3b3b;
      border-color: #ff9a9a;
      box-shadow: 0 0 10px rgba(255,60,60,0.7);
    }

    /* -------------------------------
       ë¬¸ì œ/ê²°ê³¼ ì˜¤ë²„ë ˆì´
    --------------------------------*/
    .overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.45);
    }

    .overlay-inner {
      padding: 12px;
      background: rgba(4,8,16,0.9);
      border: 1px solid rgba(120,200,255,0.4);
      border-radius: 12px;
    }

    #questionImage {
      max-width: 75vw;
      max-height: 70vh;
      object-fit: contain;
    }

    .result-screen {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* âœ… ê²°ê³¼ ì´ë¯¸ì§€ ë„ˆë¬´ í¬ì§€ ì•Šê²Œ ì œí•œ */
    #resultImage {
      width: auto;
      height: auto;
      max-width: 420px;
      max-height: 260px;
      object-fit: contain;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }

    /* -------------------------------
       í•˜ë‹¨ ë²„íŠ¼
    --------------------------------*/
    .bottom-panel {
      position: absolute;
      bottom: 32px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 18px;
      background: rgba(5,7,10,0.7);
      padding: 10px 14px;
      border-radius: 14px;
    }

    .choice-btn {
      min-width: 120px;
      padding: 10px 16px;
      border-radius: 8px;
      border: 1px solid rgba(180,200,220,0.8);
      background: rgba(10,18,30,0.95);
      color: #fff;
      font-weight: 700;
      cursor: pointer;
    }

    /* ì˜¤ë¥¸ìª½ ë¹¨ê°„ ì˜¤ë‹µ ë²„íŠ¼ */
    .fail-btn {
      position: absolute;
      right: 20px;
      bottom: 40px;
      width: 50px;
      height: 50px;
      background: #ff2b2b;
      border: 2px solid #ff7373;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 0 12px rgba(255,0,0,0.6);
    }

    .reset-icon {
      position: absolute;
      right: 16px;
      bottom: 16px;
      width: 60px;
      cursor: pointer;
      image-rendering: pixelated;
      filter: drop-shadow(0 0 8px rgba(0, 0, 0, 0.9));
    }

    .hidden { display: none; }
  </style>
</head>

<body>
  <div class="app">

    <!-- ğŸ”µ ìƒë‹¨ íƒ€ì´ë¨¸ + í˜ì´ì¦ˆ + ì„¤ëª… + ê²Œì´ì§€ -->
    <div class="top-bar">
      <span class="timer-phase" id="timerPhase">ROUND</span>
      <span class="timer-display" id="timerDisplay">00:20</span>
      <span class="round-hint">20ì´ˆ ì•ˆì— ì •ë‹µ ì…ë ¥ â†’ ì´í›„ 10ì´ˆ íŒì •</span>

      <div class="gauge-box">
        <div class="gauge active" id="g1"></div>
        <div class="gauge" id="g2"></div>
        <div class="gauge" id="g3"></div>
      </div>
    </div>

    <!-- ë¬¸ì œ íŒì—… -->
    <div id="questionOverlay" class="overlay hidden">
      <div class="overlay-inner">
        <img id="questionImage" />
      </div>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ -->
    <div id="resultScreen" class="result-screen hidden">
      <img id="resultImage" />
    </div>

    <!-- ì¢Œ/ìš° ì„ íƒ ë²„íŠ¼ -->
    <div class="bottom-panel">
      <button id="choice1Btn" class="choice-btn">ì™¼ìª½</button>
      <button id="choice2Btn" class="choice-btn">ì˜¤ë¥¸ìª½</button>
    </div>

    <!-- ë¹¨ê°„ ì˜¤ë‹µ ë²„íŠ¼ -->
    <div id="failBtn" class="fail-btn"></div>

    <!-- ë¦¬ì…‹ ì•„ì´ì½˜ -->
    <img id="resetIcon" class="reset-icon" src="static/malware_cat_2.png" />
  </div>

  <script>
    /* -------------------------
       ë¬¸ì œ & ì •ë‹µ ë°ì´í„°
    --------------------------*/
    const TOTAL = 32;
    const QUESTION_IMAGES = Array.from({ length: TOTAL }, (_, i) =>
      `static/s2_q_virus_V${i+1}.png`
    );

    const ANSWERS = {
      1: 1,  2: 2,  3: 2,  4: 2,
      5: 2,  6: 2,  7: 2,  8: 2,
      9: 1,  10: 1, 11: 2, 12: 1,
      13: 1, 14: 2, 15: 2, 16: 1,
      17: 1, 18: 2, 19: 2, 20: 1,
      21: 2, 22: 2, 23: 1, 24: 2,
      25: 1, 26: 2, 27: 2, 28: 2,
      29: 1, 30: 1, 31: 2, 32: 2
    };

    const RESULT_OK   = "static/s2_r_virus_o.png";
    const RESULT_FAIL = "static/s2_r_virus_x.png";

    /* -------------------------
       DOM
    --------------------------*/
    const questionOverlay = document.getElementById("questionOverlay");
    const questionImage   = document.getElementById("questionImage");
    const resultScreen    = document.getElementById("resultScreen");
    const resultImage     = document.getElementById("resultImage");
    const timerDisplayEl  = document.getElementById("timerDisplay");
    const timerPhaseEl    = document.getElementById("timerPhase");

    const failBtn    = document.getElementById("failBtn");
    const choice1Btn = document.getElementById("choice1Btn");
    const choice2Btn = document.getElementById("choice2Btn");
    const resetIcon  = document.getElementById("resetIcon");

    const g1 = document.getElementById("g1");
    const g2 = document.getElementById("g2");
    const g3 = document.getElementById("g3");

    /* -------------------------
       ìƒíƒœê°’
    --------------------------*/
    const ROUND_SECONDS = 20; // ì •ë‹µ ì…ë ¥ ì‹œê°„
    const JUDGE_SECONDS = 10; // íŒì • ìœ ì§€ ì‹œê°„

    let timeLeft = ROUND_SECONDS;
    let phase = "round";        // "round" | "judge"
    let timerId = null;

    let current = null;         // í˜„ì¬ ë¬¸ì œ ë²ˆí˜¸ (1~32)
    let answeredThisRound = false;

    let gaugeLevel = 1;         // 1~3

    /* -------------------------
       ê²Œì´ì§€ ê°±ì‹ 
    --------------------------*/
    function updateGauge() {
      g1.classList.toggle("active", gaugeLevel >= 1);
      g2.classList.toggle("active", gaugeLevel >= 2);
      g3.classList.toggle("active", gaugeLevel >= 3);
    }

    /* -------------------------
       íƒ€ì´ë¨¸ í‘œì‹œ + í˜ì´ì¦ˆ ìƒ‰ìƒ
    --------------------------*/
    function updateTimer() {
      const m = String(Math.floor(timeLeft / 60)).padStart(2, "0");
      const s = String(timeLeft % 60).padStart(2, "0");
      timerDisplayEl.textContent = `${m}:${s}`;

      if (phase === "round") {
        timerPhaseEl.textContent = "ROUND";
        timerPhaseEl.style.color = "#a3b7ff";
        timerDisplayEl.style.color = "#00ffd0";
      } else {
        timerPhaseEl.textContent = "JUDGE";
        timerPhaseEl.style.color = "#ffcf66";
        timerDisplayEl.style.color = "#ffcf66";
      }
    }

    /* -------------------------
       ë¬¸ì œ ìƒì„±
    --------------------------*/
    function newQuestion() {
      current = Math.floor(Math.random() * TOTAL) + 1;
      questionImage.src = QUESTION_IMAGES[current - 1];
      questionOverlay.classList.remove("hidden");
      resultScreen.classList.add("hidden");
      answeredThisRound = false;
    }

    /* -------------------------
       ê²°ê³¼ í‘œì‹œ
    --------------------------*/
    function showResult(isCorrect) {
      if (answeredThisRound) return;

      resultImage.src = isCorrect ? RESULT_OK : RESULT_FAIL;
      resultScreen.classList.remove("hidden");
      questionOverlay.classList.add("hidden");

      if (!isCorrect) {
        // ì˜¤ë‹µì‹œ ê°ì—¼ ë‹¨ê³„ 1 â†’ 2 â†’ 3 â†’ 1 ìˆœí™˜
        gaugeLevel = (gaugeLevel % 3) + 1;
        updateGauge();
      }

      answeredThisRound = true;
    }

    /* -------------------------
       ì •ë‹µ ì²´í¬
    --------------------------*/
    function check(choice) {
      if (phase !== "round") return;
      if (answeredThisRound) return;
      if (!current) return;

      const ok = ANSWERS[current] === choice;
      showResult(ok);
    }

    /* -------------------------
       íƒ€ì´ë¨¸ tick
    --------------------------*/
    function tick() {
      if (timeLeft > 0) {
        timeLeft--;
        updateTimer();
        return;
      }

      if (phase === "round" && timeLeft === 0) {
        // ì‹œê°„ ì´ˆê³¼ â†’ ì˜¤ë‹µ ì²˜ë¦¬
        if (!answeredThisRound) {
          showResult(false); // ì—¬ê¸°ì„œ ê²Œì´ì§€ +1
        }
        phase = "judge";
        timeLeft = JUDGE_SECONDS;
        updateTimer();
        return;
      }

      // íŒì •ì‹œê°„ ëë‚˜ë„ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¼ìš´ë“œ ì‹œì‘í•˜ì§€ ì•ŠìŒ
      if (phase === "judge" && timeLeft === 0) {
        if (timerId) {
          clearInterval(timerId);
          timerId = null;
        }
        // ê²°ê³¼ í™”ë©´ + JUDGE 00:00 ìƒíƒœë¡œ ê·¸ëŒ€ë¡œ ìœ ì§€
        return;
      }
    }

    /* -------------------------
       ë¼ìš´ë“œ ì‹œì‘
    --------------------------*/
    function startRound() {
      phase = "round";
      timeLeft = ROUND_SECONDS;
      answeredThisRound = false;
      newQuestion();
      updateTimer();

      if (timerId) clearInterval(timerId);
      timerId = setInterval(tick, 1000);
    }

    /* -------------------------
       ì´ë²¤íŠ¸
    --------------------------*/
    choice1Btn.onclick = () => check(1);
    choice2Btn.onclick = () => check(2);
    failBtn.onclick    = () => showResult(false);

    // ë¦¬ì…‹: ì™„ì „ ì´ˆê¸°í™” (ê²Œì´ì§€ 1ë‹¨ê³„ + ìƒˆ ë¼ìš´ë“œ)
    resetIcon.onclick = () => {
      gaugeLevel = 1;
      updateGauge();
      startRound();
    };

    document.addEventListener("keydown", (e) => {
      // ìŠ¤í˜ì´ìŠ¤ë°”: ë””ë²„ê·¸ìš© - ROUNDì¼ ë•Œë§Œ, ë¬¸ì œ ì—†ìœ¼ë©´ ìƒˆ ë¬¸ì œ
      if (e.code === "Space" && !e.repeat && phase === "round") {
        e.preventDefault();
        if (!current) newQuestion();
      }

      // [ í‚¤: ë””ë²„ê·¸ í™”ë©´ìœ¼ë¡œ ì´ë™
      if (e.key === "[") {
        window.location.href = "S2-1-001-debug.html";
      }

      // ğŸ”º Q: JUDGE ìƒíƒœì—ì„œë§Œ ë‹¤ìŒ ë¼ìš´ë“œ ê°•ì œ ì‹œì‘
      if (e.key === "q" || e.key === "Q") {
        if (phase === "judge" && answeredThisRound) {
          startRound();
        }
      }

      // ğŸ”º W: ê°ì—¼ ê²Œì´ì§€ ë‹¨ê³„ -1 (ìµœì†Œ 1)
      if (e.key === "w" || e.key === "W") {
        gaugeLevel = Math.max(1, gaugeLevel - 1);
        updateGauge();
      }

      // ğŸ”º E: ê°ì—¼ ê²Œì´ì§€ ë‹¨ê³„ +1 (ìµœëŒ€ 3)
      if (e.key === "e" || e.key === "E") {
        gaugeLevel = Math.min(3, gaugeLevel + 1);
        updateGauge();
      }
    });

    /* -------------------------
       ì´ˆê¸° ì‹¤í–‰
    --------------------------*/
    function init() {
      gaugeLevel = 1;
      updateGauge();
      startRound();
    }

    init();
  </script>
</body>
</html>
